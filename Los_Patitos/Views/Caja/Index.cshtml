@model IEnumerable<Los_Patitos.Models.CajaModel>
@{
    ViewData["Title"] = "Cajas del Comercio";
    int idComercio = ViewBag.IdComercio;
    string nombreComercio = ViewBag.NombreComercio ?? "Comercio";
}

<div class="py-6">

    <!-- Título -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-sky-700">@ViewData["Title"]</h1>
        <p class="text-gray-600">Administración de cajas asociadas al comercio.</p>
        <p class="mt-2 text-sm text-gray-500">
            Comercio: <span class="font-semibold text-gray-800">@nombreComercio</span>
        </p>
    </div>

    <!-- Card de acciones -->
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-5 mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div>
                <h2 class="text-base font-semibold text-gray-800">Acciones</h2>
                <p class="text-sm text-gray-500">Cree una nueva caja o regrese al listado de comercios.</p>
            </div>

            <div class="flex flex-col sm:flex-row gap-3">
                <a asp-action="Crear" asp-route-idComercio="@idComercio"
                   class="inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2.5
                          text-sm font-medium text-white hover:bg-sky-700">
                    Crear nueva caja
                </a>

                <a asp-controller="Comercio" asp-action="Index"
                   class="inline-flex items-center justify-center rounded-lg border border-gray-300 bg-white
                          px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50">
                    Volver a comercios
                </a>
            </div>
        </div>
    </div>

    @if (Model == null || !Model.Any())
    {
        <div class="rounded-lg border border-gray-200 bg-white p-6 text-gray-600">
            No hay cajas registradas para este comercio.
        </div>
    }
    else
    {
        <!-- Tabla -->
        <div class="overflow-x-auto bg-white border border-gray-200 shadow-sm rounded-lg">
            <table class="min-w-full text-sm text-left text-gray-600">

                <thead class="bg-sky-50 text-sky-700 text-xs uppercase font-medium border-b border-gray-200">
                    <tr>
                        <th class="px-4 py-3">Nombre</th>
                        <th class="px-4 py-3">Descripción</th>
                        <th class="px-4 py-3">Teléfono SINPE</th>
                        <th class="px-4 py-3">Fecha de registro</th>
                        <th class="px-4 py-3">Estado</th>
                        <th class="px-4 py-3 w-[220px]">Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var c in Model)
                    {
                        var desc = c.Descripcion ?? "";
                        var descCorta = desc.Length > 35 ? desc.Substring(0, 35) + "..." : desc;

                        <tr class="border-b hover:bg-gray-50">

                            <td class="px-4 py-3 font-medium text-gray-900">@c.Nombre</td>

                            <td class="px-4 py-3">
                                <span title="@desc">@descCorta</span>
                            </td>

                            <td class="px-4 py-3 whitespace-nowrap">@c.TelefonoSINPE</td>

                            <td class="px-4 py-3 whitespace-nowrap">@c.FechaDeRegistro.ToString("dd/MM/yyyy")</td>

                            <td class="px-4 py-3">
                                <span class="px-2 py-1 rounded-md text-xs font-bold
                                            @(c.Estado ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700")">
                                    @(c.Estado ? "Activo" : "Inactivo")
                                </span>
                            </td>

                            <td class="px-4 py-3">
                                <div class="flex flex-wrap gap-2">
                                    <a asp-action="Editar" asp-route-id="@c.IdCaja"
                                       class="inline-flex items-center justify-center rounded-lg bg-yellow-500 px-3 py-2
                                                      text-xs font-semibold text-white hover:bg-yellow-600">
                                        Editar
                                    </a>

                                    <a asp-action="VerSinpe" asp-route-idCaja="@c.IdCaja"
                                       class="inline-flex items-center justify-center rounded-lg bg-sky-600 px-3 py-2
                                                      text-xs font-semibold text-white hover:bg-sky-700">
                                        Ver SINPE
                                    </a>
                                </div>
                            </td>

                        </tr>
                    }
                </tbody>

            </table>
        </div>
    }

</div>